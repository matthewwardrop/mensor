
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.9">
    
    
      
        <title>Quickstart - Mensor</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quickstart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Mensor" class="md-header__button md-logo" aria-label="Mensor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mensor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quickstart
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Overview
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        User Guides
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Mensor" class="md-nav__button md-logo" aria-label="Mensor" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Mensor
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributions/" class="md-nav__link">
        Contributions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          User Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Quickstart
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Quickstart
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#toy-data-schema" class="md-nav__link">
    Toy Data Schema
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-role-of-measureproviders" class="md-nav__link">
    The role of MeasureProviders
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-measures-from-the-metameasureprovider" class="md-nav__link">
    Evaluating measures from the MetaMeasureProvider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constraints" class="md-nav__link">
    Constraints
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#toy-data-schema" class="md-nav__link">
    Toy Data Schema
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-role-of-measureproviders" class="md-nav__link">
    The role of MeasureProviders
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evaluating-measures-from-the-metameasureprovider" class="md-nav__link">
    Evaluating measures from the MetaMeasureProvider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constraints" class="md-nav__link">
    Constraints
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="quickstart">Quickstart</h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This resource is in draft status, and missing essential pieces of
information, such as outputs of the various examples. This will be remedied
once output data types are finalised. The exact API used below is subject to
change as the project matures, but the ideas and generic grammar is unlikely
to vary. Note also that we do not discuss metrics yet as that API has yet to
solidify.</p>
</div>
<p>If you have not read the <a href="../concepts/">concepts</a> documentation, and find any of the
following unclear, be sure to go and read this documentation. If this resource
remains unclear, that is no doubt the fault of the author, and you should feel
free to reach out by creating a <a href="http://github.com/matthewwardrop/mensor/issues">GitHub issue</a>.</p>
<p>In the following, we will explore the use of Mensor in a toy example backed by
pandas data frames. All of the code shown on this page can be run equally well
in your own Python session if you would like to play with it locally. Note that
Mensor is agnostic as to where data is stored, so nothing changes in this API
for data stored in database tables.</p>
<h2 id="toy-data-schema">Toy Data Schema</h2>
<p>The following examples of using mensor will use the following toy schema,
which does a reasonable job of demonstrating most of mensor's features.</p>
<p><img alt="Toy Schema" src="../../assets/toy_schema.png" /></p>
<p>For the purposes of this tutorial, we will back this schema with pandas
dataframes loaded from CSV files, but as far as mensor is concerned, the source
of the data is irrelevant. The following Python code sets up a MetaMeasureProvider
which connects to data following the above schema. It is possible to easily set
up configuration from YAML files, but we defer such consideration to the as-yet TBD deployment documentation.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mensor.measures</span> <span class="kn">import</span> <span class="n">MetaMeasureProvider</span>
<span class="kn">from</span> <span class="nn">mensor.backends.pandas</span> <span class="kn">import</span> <span class="n">PandasMeasureProvider</span>

<span class="n">registry</span> <span class="o">=</span> <span class="n">MetaMeasureProvider</span><span class="p">()</span>

<span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;&lt;path to checked out Mensor repository&gt;/tests/data&quot;</span>

<span class="n">people</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PandasMeasureProvider</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;people&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;people.csv&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_identifier</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;primary&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_dimension</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_measure</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_partition</span><span class="p">(</span><span class="s1">&#39;ds&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>

<span class="n">people2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PandasMeasureProvider</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;people2&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;people.csv&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_identifier</span><span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;unique&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_identifier</span><span class="p">(</span><span class="s1">&#39;geography&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;id_geography&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;foreign&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_partition</span><span class="p">(</span><span class="s1">&#39;ds&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">people2</span><span class="p">)</span>

<span class="n">geographies</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PandasMeasureProvider</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;geographies&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;geographies.csv&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_identifier</span><span class="p">(</span><span class="s1">&#39;geography&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;id_geography&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;primary&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_dimension</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_measure</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_partition</span><span class="p">(</span><span class="s1">&#39;ds&#39;</span><span class="p">)</span>

<span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">geographies</span><span class="p">)</span>

<span class="n">transactions</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PandasMeasureProvider</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;transactions&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;transactions.csv&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_identifier</span><span class="p">(</span><span class="s1">&#39;transaction&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;primary&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_identifier</span><span class="p">(</span><span class="s1">&#39;person:buyer&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;id_buyer&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;foreign&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_identifier</span><span class="p">(</span><span class="s1">&#39;person:seller&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;id_seller&#39;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;foreign&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_measure</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_partition</span><span class="p">(</span><span class="s1">&#39;ds&#39;</span><span class="p">,</span> <span class="n">requires_constraint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">transactions</span><span class="p">)</span>
</code></pre></div>
<h2 id="the-role-of-measureproviders">The role of MeasureProviders</h2>
<p>In the above code, we registered several <code>MeasureProvider</code> instances with
a <code>MetaMeasureProvider</code> instance. Each <code>MeasureProvider</code> has the
responsibility of being able to provide everything it promised upon request, and
we can test this for any particular <code>MeasureProvider</code> directly. For
example, we can ask the <code>transactions</code> measure provider for the sum
over all transactions of their value segmented by seller id where the <code>ds</code> is
<code>'2018-01-01'</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">transactions</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">unit_type</span><span class="o">=</span><span class="s1">&#39;transaction&#39;</span><span class="p">,</span>
    <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
    <span class="n">segment_by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;person:seller&#39;</span><span class="p">],</span>
    <span class="n">where</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ds&#39;</span><span class="p">:</span> <span class="s1">&#39;2018-01-01&#39;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>The returned data is a Pandas Dataframe subclass which knows how to keep track
of statistics.</p>
<div class="admonition todo">
<p class="admonition-title">Todo</p>
<p>This documentation is incomplete on this point, and will be extended once
this component of mensor solidifies.</p>
</div>
<h2 id="evaluating-measures-from-the-metameasureprovider">Evaluating measures from the MetaMeasureProvider</h2>
<p>While it is nice that you can directly evaluate measure from a single
<code>MeasureProvider</code>, we have not really gained much over just
directly accessing the data. Suppose, however, we wish to segment the
transaction value measure by sellers' names. Now we need information from
multiple providers, and this starts to be a little more taxing if we directly
access the data. In Mensor, however, it is as simple as:</p>
<div class="highlight"><pre><span></span><code><span class="n">registry</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">unit_type</span><span class="o">=</span><span class="s1">&#39;transaction&#39;</span><span class="p">,</span>
    <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
    <span class="n">segment_by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;person:seller/name&#39;</span><span class="p">],</span>
    <span class="n">where</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ds&#39;</span><span class="p">:</span> <span class="s1">&#39;2018-01-01&#39;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>In the background, mensor is separately asking the <code>transactions</code> and <code>people</code>
data sources for data, and stitching them together for you.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For some backends, such as SQL, dragging down the data locally and doing the
joins in memory would be horrendously inefficient. To cater for this use case,
<code>MeasureProvider</code>s have a notion of an "intermediate representation"
which they can share with other measure providers that they know to be
compatible with themselves. Unless you are deploying Mensor, and need to be
aware of such things, this is an implementation detail that is transparent
to the user.</p>
</div>
<p>Likewise, one might be interested in segmenting the value of transactions and
the seller's age by the name of the geography of the seller <strong>and</strong> the buyer's
name (admittedly a very contrived example):</p>
<div class="highlight"><pre><span></span><code><span class="n">registry</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">unit_type</span><span class="o">=</span><span class="s1">&#39;transaction&#39;</span><span class="p">,</span>
    <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;person:seller/age&#39;</span><span class="p">],</span>
    <span class="n">segment_by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;person:buyer/name&#39;</span><span class="p">,</span> <span class="s1">&#39;person:seller/geography/name&#39;</span><span class="p">],</span>
    <span class="n">where</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ds&#39;</span><span class="p">:</span> <span class="s1">&#39;2018-01-01&#39;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>Note that mensor also automatically stitched together providers which had the
same primary key ("person") in this case.</p>
<p>So far, we have only considered the unit type of 'transaction', but it is also
possible to consider other unit types.</p>
<p>What if we want the distribution of transaction values across sellers, segmented
by seller name?</p>
<div class="highlight"><pre><span></span><code><span class="n">registry</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">unit_type</span><span class="o">=</span><span class="s1">&#39;person:seller&#39;</span><span class="p">,</span>
    <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;transaction/value&#39;</span><span class="p">],</span>
    <span class="n">segment_by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;person:seller/name&#39;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>Note the magic that just occurred there. There is no foreign key from
<code>person:seller</code> to <code>transaction</code>, but there is a foreign key from <code>transaction</code> to
<code>person:seller</code>. Mensor took advantage of this to re-aggregate transactions by
<code>person:seller</code> and the join the resulting sum as a feature of <code>person:seller</code>.</p>
<p>Also note that you cannot do the following (because it does not make sense):</p>
<div class="highlight"><pre><span></span><code><span class="n">registry</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">unit_type</span><span class="o">=</span><span class="s1">&#39;person:seller&#39;</span><span class="p">,</span>
    <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;transaction/value&#39;</span><span class="p">],</span>
    <span class="n">segment_by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;transaction/person:buyer/name&#39;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>This is because it violates the explicit indivisible unit of the analysis
(<code>person:seller</code>); i.e. a seller may have multiple transactions with different
buyers, and so segmenting by any feature of transaction (or its derivatives)
would violate the assumption that <code>person:seller</code> is the indivisible unit.
As such, mensor prevents you from making a statistical faux pas.</p>
<h2 id="constraints">Constraints</h2>
<p>There are three principle ways that constraints can be applied, and a rich
syntax for specifying the exact contraints.</p>
<p>The constraint application methods are:</p>
<ul>
<li><strong>scoped:</strong>
    This is the most explicit constraint application method, and allows you
    to define the constraints that must be enforced even if it is the only
    reason for accessing a particular measure provider. For example, for unit
    type transaction: {'person:seller/name': "Matthew"} would restrict
    transactions to those whose sellers' name was "Matthew", regardless of which
    measures and segmentations were provided.</li>
<li><strong>generic:</strong>
    This is the most lenient constraint, that only applies if the nominated
    feature appears in the measure provider being evaluated; but is otherwise
    silently ignored. Note that it applies <em>generically</em> and so will match
    any measure provider with the nominated field name. For example:
    {'*/name': 'Matthew'} will filter down to results that have 'name' equal
    to 'Matthew' for any measure provider that has the field 'name', but is
    otherwise not enforced.</li>
<li><strong>generic for a given unit_type:</strong>
    This is a cross between the above to methods, which allows a constraint to
    be enforced whenever a given unit type is being considered, at which point
    it is enforced and if the unit_type lacks that feature, an error is thrown.
    For example: {'*/person:seller/name': 'Matthew'} will enforce that
    <code>name == 'Matthew'</code> every time the current unit type is <code>person:seller</code>,
    but is otherwise ignored.</li>
</ul>
<p>(Mostly) irrespective of the application method, constraints can be specified in
a rich variety of ways. The possible constraint types are:</p>
<ul>
<li><strong>equality:</strong>
    <code>{'ds': '2018-01-01'}</code> implies <code>[ ds=='2018-01-01']</code>.</li>
<li><strong>inequality:</strong>
    <code>{'ds': ('&lt;', '2018-01-01')}</code> implies <code>[ ds&lt;'2018-01-01' ]</code>.
    The supported operations are: <code>['&lt;', '&gt;', '&lt;=', '&gt;=']</code>.</li>
<li><strong>in:</strong>
    <code>{'ds': {1,2,3}}</code> implies <code>[ ds ∈ {1, 2, 3} ]</code></li>
<li><strong>and:</strong>
    A dictionary or list of dictionaries creates and AND condition, for example:
    <code>[{'ds': '2018-01-01', 'name': 'Matthew'}, {'other': 1}]</code> implies:
    <code>[ ds=='2018-01-01' &amp; name=='Matthew' &amp; other==1 ]</code></li>
<li><strong>or:</strong>
    A tuple of dictionaries implies an OR condition:
    <code>({'ds': '2018-01-01'}, {'other': 1})</code> implies:
    <code>( ds=='2018-01-01' | other==1)</code></li>
<li><strong>and (nested):</strong>
    <code>{'field': [('&gt;', 1), ('&lt;', 2)]}</code> implies <code>[ field&gt;1 &amp; field&lt;2 ]</code></li>
</ul>
<p>The types can be nested also, for example:
<code>[({'a': 1, 'b':2}, {'c':3, 'd':4}), ({'e': 5, 'f':6}, {'g':7, 'h':8})]</code>
implies
<code>[ ( [ a==1 &amp; b==2 ] | [ c==3 &amp; d==4 ] ) &amp; ( [ e==5 &amp; f==6 ] | [ g==7 &amp; h==8 ] ) ]</code>.</p>
<p>Additionally, it is possible to have constraints at different levels in the join
hierarchy (for scoped constraints). For example:
<code>({'transaction/value': 100}, {'transaction/person:seller/name': 'Matthew'})</code>
implies
<code>( transaction/value==100 | transaction/person:seller/name=='Matthew' )</code>.</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../concepts/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Concepts" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Concepts
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>